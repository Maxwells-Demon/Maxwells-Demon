<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Photos Album Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .auth-section {
            text-align: center;
            margin-bottom: 30px;
        }

        button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
            min-width: 120px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
            font-weight: 500;
        }

        .status.success {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .status.error {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        .status.info {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .albums-section {
            margin: 30px 0;
        }

        .album-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            margin-bottom: 20px;
            background: white;
        }

        .photos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .photo-item {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .photo-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }

        .photo-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .photo-item:hover img {
            transform: scale(1.05);
        }

        .photo-info {
            padding: 15px;
        }

        .photo-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .photo-date {
            color: #666;
            font-size: 14px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #666;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }

        .modal-content img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            z-index: 1001;
        }

        .setup-info {
            background: linear-gradient(45deg, #FFF3E0, #FFE0B2);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #FF9800;
        }

        .setup-info h3 {
            color: #E65100;
            margin-bottom: 10px;
        }

        .setup-info ol {
            color: #BF360C;
            margin-left: 20px;
        }

        .setup-info li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì∏ Google Photos Album Viewer</h1>
        
        <div class="setup-info">
            <h3>Setup Instructions:</h3>
            <ol>
                <li>Go to <a href="https://console.developers.google.com/" target="_blank">Google Cloud Console</a></li>
                <li>Create a new project or select existing one</li>
                <li>Enable the "Photos Library API"</li>
                <li>Create credentials (OAuth 2.0 Client ID) for web application</li>
                <li>Add your domain to authorized origins</li>
                <li>Replace CLIENT_ID below with your actual client ID</li>
            </ol>
        </div>

        <div class="auth-section">
            <button id="authBtn" onclick="handleAuth()">Sign in with Google</button>
            <button id="signOutBtn" onclick="signOut()" style="display: none;">Sign Out</button>
        </div>

        <div id="status"></div>

        <div class="albums-section" style="display: none;" id="albumsSection">
            <select id="albumSelect" class="album-select">
                <option value="">Select an album...</option>
            </select>
            <button onclick="loadPhotos()">Load Photos</button>
        </div>

        <div id="photosContainer"></div>
    </div>

    <!-- Modal for full-size image viewing -->
    <div id="photoModal" class="modal">
        <span class="close" onclick="closeModal()">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        // Replace with your actual OAuth 2.0 Client ID from Google Cloud Console
        const CLIENT_ID = '322612768318-80h32spe5u74600u5b27tsqnd9772u7j.apps.googleusercontent.com';
        const DISCOVERY_DOC = 'https://photoslibrary.googleapis.com/$discovery/rest';
        const SCOPES = 'https://www.googleapis.com/auth/photoslibrary.readonly';

        let gapi;
        let tokenClient;
        let accessToken = '';
        let albums = [];
        let selectedAlbumId = '';

        // Load Google API scripts dynamically with fallbacks
        function loadGoogleAPIs() {
            return new Promise((resolve, reject) => {
                let gapiLoaded = false;
                let gisLoaded = false;
                
                function checkCompletion() {
                    if (gapiLoaded && gisLoaded) {
                        resolve();
                    }
                }
                
                // Load Google API script with multiple attempts
                function loadGapi(attempt = 1) {
                    const gapiScript = document.createElement('script');
                    const gapiUrls = [
                        'https://apis.google.com/js/api.js',
                        'https://cdnjs.cloudflare.com/ajax/libs/google-api-javascript-client/2.2.2/gapi.min.js'
                    ];
                    
                    gapiScript.src = gapiUrls[attempt - 1] || gapiUrls[0];
                    
                    gapiScript.onload = () => {
                        // Wait for gapi to be available
                        const checkGapi = setInterval(() => {
                            if (typeof gapi !== 'undefined') {
                                clearInterval(checkGapi);
                                gapiLoaded = true;
                                checkCompletion();
                            }
                        }, 100);
                        
                        // Timeout after 5 seconds
                        setTimeout(() => {
                            clearInterval(checkGapi);
                            if (!gapiLoaded && attempt < 2) {
                                document.head.removeChild(gapiScript);
                                loadGapi(attempt + 1);
                            } else if (!gapiLoaded) {
                                reject(new Error('GAPI not available after loading'));
                            }
                        }, 5000);
                    };
                    
                    gapiScript.onerror = () => {
                        if (attempt < 2) {
                            loadGapi(attempt + 1);
                        } else {
                            reject(new Error('Failed to load Google API script'));
                        }
                    };
                    
                    document.head.appendChild(gapiScript);
                }
                
                // Load Google Identity Services script
                function loadGIS() {
                    const gisScript = document.createElement('script');
                    gisScript.src = 'https://accounts.google.com/gsi/client';
                    
                    gisScript.onload = () => {
                        // Wait for google accounts to be available
                        const checkGIS = setInterval(() => {
                            if (typeof google !== 'undefined' && google.accounts) {
                                clearInterval(checkGIS);
                                gisLoaded = true;
                                checkCompletion();
                            }
                        }, 100);
                        
                        // Timeout after 5 seconds
                        setTimeout(() => {
                            clearInterval(checkGIS);
                            if (!gisLoaded) {
                                reject(new Error('Google Identity Services not available after loading'));
                            }
                        }, 5000);
                    };
                    
                    gisScript.onerror = () => {
                        reject(new Error('Failed to load Google Identity Services'));
                    };
                    
                    document.head.appendChild(gisScript);
                }
                
                // Start loading both scripts
                loadGapi();
                loadGIS();
            });
        }

        // Initialize the Google API
        async function initializeGapi() {
            if (CLIENT_ID === 'YOUR_CLIENT_ID_HERE.apps.googleusercontent.com') {
                showStatus('‚ö†Ô∏è Setup Required: Please replace CLIENT_ID with your actual Google OAuth Client ID from Google Cloud Console', 'error');
                return;
            }

            try {
                showStatus('üîÑ Loading Google APIs...', 'info');
                
                // Load the scripts
                await loadGoogleAPIs();
                
                showStatus('üîÑ Initializing Google Client...', 'info');

                // Initialize gapi client
                await new Promise((resolve, reject) => {
                    gapi.load('client', {
                        callback: async () => {
                            try {
                                await gapi.client.init({});
                                resolve();
                            } catch (error) {
                                reject(error);
                            }
                        },
                        onerror: reject
                    });
                });

                // Initialize Google Identity Services
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CLIENT_ID,
                    scope: SCOPES,
                    callback: tokenCallback,
                });

                showStatus('‚úÖ Google API initialized successfully! You can now sign in.', 'success');
                
            } catch (error) {
                showStatus('‚ùå Failed to initialize Google API: ' + error.message, 'error');
                console.error('Detailed error:', error);
                
                // Provide troubleshooting info
                console.log('Troubleshooting info:');
                console.log('- gapi available:', typeof gapi !== 'undefined');
                console.log('- google available:', typeof google !== 'undefined');
                console.log('- google.accounts available:', typeof google !== 'undefined' && !!google.accounts);
            }
        }

        // Handle authentication
        function handleAuth() {
            if (!tokenClient) {
                showStatus('Please wait for API initialization', 'error');
                return;
            }
            tokenClient.requestAccessToken();
        }

        // Token callback
        function tokenCallback(response) {
            if (response.error !== undefined) {
                showStatus('Authentication failed: ' + response.error, 'error');
                return;
            }

            accessToken = response.access_token;
            gapi.client.setToken({ access_token: accessToken });
            
            document.getElementById('authBtn').style.display = 'none';
            document.getElementById('signOutBtn').style.display = 'inline-block';
            
            showStatus('Successfully authenticated!', 'success');
            loadAlbums();
        }

        // Sign out
        function signOut() {
            gapi.client.setToken(null);
            accessToken = '';
            document.getElementById('authBtn').style.display = 'inline-block';
            document.getElementById('signOutBtn').style.display = 'none';
            document.getElementById('albumsSection').style.display = 'none';
            document.getElementById('photosContainer').innerHTML = '';
            showStatus('Signed out successfully', 'info');
        }

        // Load albums
        async function loadAlbums() {
            try {
                showStatus('Loading albums...', 'info');
                
                const response = await fetch('https://photoslibrary.googleapis.com/v1/albums', {
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                albums = data.albums || [];
                
                const albumSelect = document.getElementById('albumSelect');
                albumSelect.innerHTML = '<option value="">Select an album...</option>';
                
                albums.forEach(album => {
                    const option = document.createElement('option');
                    option.value = album.id;
                    option.textContent = `${album.title} (${album.mediaItemsCount || 0} items)`;
                    albumSelect.appendChild(option);
                });

                document.getElementById('albumsSection').style.display = 'block';
                showStatus(`Found ${albums.length} albums`, 'success');
                
            } catch (error) {
                showStatus('Failed to load albums: ' + error.message, 'error');
            }
        }

        // Load photos from selected album
        async function loadPhotos() {
            const albumSelect = document.getElementById('albumSelect');
            selectedAlbumId = albumSelect.value;
            
            if (!selectedAlbumId) {
                showStatus('Please select an album first', 'error');
                return;
            }

            try {
                showStatus('Loading photos...', 'info');
                document.getElementById('photosContainer').innerHTML = '<div class="loading">Loading photos...</div>';
                
                const response = await fetch('https://photoslibrary.googleapis.com/v1/mediaItems:search', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${accessToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        albumId: selectedAlbumId,
                        pageSize: 50
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                const mediaItems = data.mediaItems || [];
                
                displayPhotos(mediaItems);
                showStatus(`Loaded ${mediaItems.length} photos`, 'success');
                
            } catch (error) {
                showStatus('Failed to load photos: ' + error.message, 'error');
                document.getElementById('photosContainer').innerHTML = '';
            }
        }

        // Display photos in grid
        function displayPhotos(mediaItems) {
            const container = document.getElementById('photosContainer');
            
            if (mediaItems.length === 0) {
                container.innerHTML = '<div class="loading">No photos found in this album</div>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'photos-grid';
            
            mediaItems.forEach(item => {
                if (item.mimeType && item.mimeType.startsWith('image/')) {
                    const photoDiv = document.createElement('div');
                    photoDiv.className = 'photo-item';
                    photoDiv.onclick = () => openModal(item.baseUrl + '=w2048-h2048');
                    
                    const img = document.createElement('img');
                    img.src = item.baseUrl + '=w400-h400-c';
                    img.alt = item.filename || 'Photo';
                    img.loading = 'lazy';
                    
                    const info = document.createElement('div');
                    info.className = 'photo-info';
                    
                    const title = document.createElement('div');
                    title.className = 'photo-title';
                    title.textContent = item.filename || 'Untitled';
                    
                    const date = document.createElement('div');
                    date.className = 'photo-date';
                    if (item.mediaMetadata && item.mediaMetadata.creationTime) {
                        date.textContent = new Date(item.mediaMetadata.creationTime).toLocaleDateString();
                    }
                    
                    info.appendChild(title);
                    info.appendChild(date);
                    photoDiv.appendChild(img);
                    photoDiv.appendChild(info);
                    grid.appendChild(photoDiv);
                }
            });
            
            container.innerHTML = '';
            container.appendChild(grid);
        }

        // Modal functions
        function openModal(imageSrc) {
            const modal = document.getElementById('photoModal');
            const modalImg = document.getElementById('modalImage');
            modal.style.display = 'block';
            modalImg.src = imageSrc;
        }

        function closeModal() {
            document.getElementById('photoModal').style.display = 'none';
        }

        // Utility function to show status messages
        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.className = `status ${type}`;
            statusDiv.textContent = message;
            statusDiv.style.display = 'block';
            
            // Auto-hide success messages after 3 seconds
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 3000);
            }
        }

        // Close modal when clicking outside the image
        window.onclick = function(event) {
            const modal = document.getElementById('photoModal');
            if (event.target === modal) {
                closeModal();
            }
        }

        // Initialize when the page loads
        window.onload = function() {
            initializeGapi();
        };
    </script>
</body>
</html>